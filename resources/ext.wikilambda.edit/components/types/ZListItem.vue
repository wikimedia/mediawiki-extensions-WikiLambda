<template>
	<!--
		WikiLambda Vue component for ZObject items in ZLists.

		@copyright 2020â€“ Abstract Wikipedia team; see AUTHORS.txt
		@license MIT
	-->
	<li class="ext-wikilambda-zlistItem">
		<cdx-button
			v-if="!( viewmode || readonly )"
			class="z-list-item-remove"
			:destructive="true"
			:title="tooltipRemoveListItem"
			@click="$emit( 'remove-item', zobjectId )"
		>
			{{ $i18n( 'wikilambda-editor-removeitem' ).text() }}
		</cdx-button>
		<z-object-selector
			v-if="isEmptyObject"
			:type="zType"
			:return-type="zType"
			:placeholder="$i18n( 'wikilambda-typeselector-label' ).text()"
			:readonly="readonly"
			@input="onTypeChange"
		></z-object-selector>
		<z-object
			v-else
			:zobject-id="zobjectId"
			:persistent="false"
			:readonly="readonly"
		></z-object>
	</li>
</template>

<script>
var typeUtils = require( '../../mixins/typeUtils.js' ),
	ZObjectSelector = require( '../ZObjectSelector.vue' ),
	CdxButton = require( '@wikimedia/codex' ).CdxButton,
	mapActions = require( 'vuex' ).mapActions,
	mapGetters = require( 'vuex' ).mapGetters;

// @vue/component
module.exports = exports = {
	name: 'z-list-item',
	components: {
		'z-object-selector': ZObjectSelector,
		'cdx-button': CdxButton
	},
	mixins: [ typeUtils ],
	inject: {
		viewmode: { default: false }
	},
	props: {
		zobjectId: {
			type: Number,
			required: true
		},
		readonly: {
			type: Boolean,
			default: false
		},
		zType: {
			type: String,
			default: ''
		}
	},
	computed: $.extend( {},
		mapGetters( {
			getZObjectChildrenById: 'getZObjectChildrenById',
			getZObjectTypeById: 'getZObjectTypeById'
		} ),
		{
			zobject: function () {
				return this.getZObjectChildrenById( this.zobjectId );
			},
			zobjectType: function () {
				return this.getZObjectTypeById( this.zobjectId );
			},
			isEmptyObject: function () {
				return !this.zobjectType;
			},
			tooltipRemoveListItem: function () {
				return this.$i18n( 'wikilambda-editor-zlist-removeitem-tooltip' ).text();
			},
			tooltipAddListItem: function () {
				this.$i18n( 'wikilambda-editor-zlist-additem-tooltip' ).text();
			}
		} ),
	methods: $.extend( {},
		mapActions( [ 'changeType' ] ),
		{
			/*
			* Sets the current list item type.
			*
			* @param {string} type
			*/
			onTypeChange: function ( type ) {
				var payload = {
					type: type,
					id: this.zobjectId
				};
				this.changeType( payload );
			}
		} ),
	beforeCreate: function () {
		this.$options.components[ 'z-object' ] = require( './../ZObject.vue' );
	}
};
</script>
